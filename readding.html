<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Lector en voz alta</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 10px;
      text-align: center;
    }
    #speed-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 1.5em;
      margin-bottom: 5px;
    }
    #controls {
      margin-bottom: 5px;
    }
    #contenido {
      margin: 5px auto;
      max-width: 90%;
      text-align: left;
      font-size: 1.3em;
    }
    #contador {
      margin-top: 10px;
      font-size: 0.9em;
      color: gray;
    }
    button {
      font-size: 1.2em;
      padding: 5px 15px;
    }
  </style>
</head>

<body>

  <h2>Lector en Voz Alta</h2>

  <div id="speed-controls">
    <span style="cursor:pointer;" onclick="changeSpeed(-0.1)">&lt;</span>
    <span id="speed-value">1.0</span>
    <span style="cursor:pointer;" onclick="changeSpeed(0.1)">&gt;</span>
  </div>

  <div id="controls">
    <button onclick="leerEnVozAlta()">Leer en voz alta</button>
  </div>

  <div id="contenido">
    <!-- Aquí se mostrará el contenido cargado automáticamente o manualmente -->
  </div>

  <div id="contador">
    <!-- Aquí se mostrará el contador de caracteres leídos -->
  </div>

<script>
  // Variables globales
  let speed = 1.0;
  let totalCaracteres = 0;
  let caracteresLeidos = 0;
  let index = 0;
  let fragmentos = [];

  // Función para cambiar la velocidad
  function changeSpeed(delta) {
    speed = Math.min(2.0, Math.max(0.5, parseFloat((speed + delta).toFixed(1))));
    document.getElementById("speed-value").textContent = speed.toFixed(1);
  }

  // Función para leer en voz alta
  function leerEnVozAlta() {
    const texto = document.getElementById('contenido').innerText;

    totalCaracteres = texto.length;
    caracteresLeidos = 0;

    // Partimos el texto en fragmentos
    fragmentos = texto.match(/[^.!?]+[.!?]?/g) || [];

    index = 0;
    hablarFragmento();
  }

  // Función para hablar fragmento por fragmento
  function hablarFragmento() {
    if (index < fragmentos.length) {
      const mensaje = new SpeechSynthesisUtterance(fragmentos[index]);
      mensaje.lang = 'es-ES';
      mensaje.pitch = 1;
      mensaje.rate = 0.6 * speed;

      mensaje.onend = function() {
        caracteresLeidos += fragmentos[index].length;
        actualizarContador();
        index++;
        hablarFragmento();
      };

      speechSynthesis.speak(mensaje);
    }
  }

  // Función para actualizar el contador en pantalla
  function actualizarContador() {
    document.getElementById("contador").textContent =
      `Caracteres leídos: ${caracteresLeidos} / ${totalCaracteres}`;
  }

  // Código para cargar el contenido automáticamente si viene un id en la URL
  window.onload = function() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    if (id) {
      const url = `https://docs.google.com/document/d/${id}/export?format=txt`;

      fetch(url)
        .then(response => response.text())
        .then(data => {
          document.getElementById('contenido').innerText = data;
        })
        .catch(error => {
          document.getElementById('contenido').innerText = 'Error al cargar el contenido.';
        });
    } else {
      document.getElementById('contenido').innerText = 'Pega aquí el texto o proporciona un ID en la URL.';
    }
  }
</script>

</body>
</html>
